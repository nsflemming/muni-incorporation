#set directory
setwd('C:/Users/natha/OneDrive/Documents/GitHub/muni-incorporation/rawdata')
#tidyverse to read in files and convenience
library(tidyverse)
#read in municipal incorporation data
muni_incorporation<-readxl::read_xlsx('muni-incorporation.xlsx')
#read in crosswalk file
fips_crosswalk<-readxl::read_xlsx('fips_crosswalk.xlsx')
#rename crosswalk variables
fips_crosswalk <- fips_crosswalk %>%
rename(census_id = `Census ID Number`,
muniname = Name,
statefips = `FIPS State Numeric Code`,
statecode = `Census State Numeric Code`,
statename = `State Name`,
stateabb = `Official USPS Code` ,
countyfips = `FIPS County Numeric Code`,
countycode = `Census County Numeric Code`,
countyname = `County Name`,
placefips = `FIPS Place Numeric Code`,
unitcode = `Census Unit Numeric Code`,
govtype = `Census Govt Type Code`,
lat = `Latitude (GNIS)`,
lon = `Longitude (GNIS)`)
# merge dataframes and save as csv
muni_incorporation_date<-left_join(muni_incorporation, fips_crosswalk, by='census_id')
write.csv(muni_incorporation_date, 'muni_incorporation_date.csv')
#set directory
setwd('C:/Users/natha/OneDrive/Documents/GitHub/muni-incorporation/rawdata')
#tidyverse to read in files and convenience
library(tidyverse)
#read in merged data file
county_incorporation<-read.csv('muni_incorporation_date.csv')
View(muni_incorporation_date)
#read in merged data file
muni_incorporation_date<-read.csv('muni_incorporation_date.csv')
#sum incorporations in each county in each year
county_incorporation<-
muni_incorporation_date %>%
group_by(stateabb, countycode, yr_incorp) %>%
tally()%>%
ungroup()
View(county_incorporation)
county_incorporation<-
muni_incorporation_date %>%
group_by(stateabb, countyname, yr_incorp) %>% #group by state, county name and year of incorporation
tally()%>% #tally up number of observations in each group
ungroup()
View(muni_incorporation_date)
#create variable that indicates year to year growth in incorporations
##fill in years with no incorporations
county_incorporation <-
county_incorporation %>%
group_by(stateabb, countyname) %>% #group by state, county name
test<-county_incorporation[county_incorporation$stateabb==MA]
#create variable that indicates year to year growth in incorporations
##fill in years with no incorporations
county_incorporation <-
county_incorporation %>%
group_by(stateabb, countyname) %>% #group by state, county name
test<-county_incorporation[county_incorporation$stateabb=='MA']
#create variable that indicates year to year growth in incorporations
##fill in years with no incorporations
county_incorporation <-
county_incorporation %>%
group_by(stateabb, countyname) %>% #group by state, county name
test<-county_incorporation[county_incorporation$stateabb=='MA',]
#create variable that indicates year to year growth in incorporations
##fill in years with no incorporations
county_incorporation <-
county_incorporation %>%
group_by(stateabb, countyname) %>% #group by state, county name
test<-county_incorporation[county_incorporation$stateabb=='MA',]
test<-county_incorporation[county_incorporation$stateabb=='MA',]
View(test)
#duplicate rows
test<-test %>%
slice(rep(1:n(), each=2))
test<-county_incorporation[county_incorporation$stateabb=='MA',]
#duplicate rows so there's one per year from the first year a muni was incorporated to the last
test<-test %>%
slice(rep(1:n(), each=(max(yr_incorp)-min(yr_incorp))))
#sum incorporations over time
test <-
test %>%
group_by(stateabb, countyname)%>%
mutate(totalincorp = sum(n))
test<-county_incorporation[county_incorporation$stateabb=='MA',]
test <-
test %>%
group_by(stateabb, countyname)%>%
mutate(totalincorp = sum(n))
test<-county_incorporation[county_incorporation$stateabb=='MA',]
#sum incorporations over time
test <-
test %>%
group_by(stateabb, countyname)%>%
mutate(totalincorp = sum(n)) %>%
ungroup()
test<-county_incorporation[county_incorporation$stateabb=='MA',]
#sum incorporations over time
test <-
test %>%
group_by(stateabb, countyname)%>%
mutate(totalincorp = sum(n),
previncorp = lag(totalincorp)) %>%
ungroup()
test<-county_incorporation[county_incorporation$stateabb=='MA',]
#sum incorporations over time
test <-
test %>%
group_by(stateabb, countyname)%>%
mutate(total_munis = sum(n), #total municipalities to date
prev_munis = lag(total_munis), #previous year's muni total
muni_chng = total_munis-prev_munis) %>% #change in number of munis
ungroup()
test <-
county_incorporation[county_incorporation$stateabb=='MA',] %>%
group_by(stateabb, countyname)%>%
mutate(current_munis =cumsum(n)) %>%
#mutate(total_munis = sum(n)) %>% #total municipalities over all time
ungroup()
test <-
county_incorporation[county_incorporation$stateabb=='MA',] %>%
group_by(stateabb, countyname)%>%
mutate(current_munis =cumsum(n), #cumulative total of municipalities
total_munis = sum(n),#total municipalities over all time
chng_munis = current_munis - lag(current_munis)) %>% # change in number of munis year to year
ungroup()
county_incorporation <-
county_incorporation %>%
group_by(stateabb, countyname)%>%#group by state, county name
mutate(current_munis = cumsum(n), #cumulative total of municipalities
total_munis = sum(n),#total municipalities over all time
chng_munis = current_munis - lag(current_munis)) %>% # change in number of munis year to year
ungroup()
View(county_incorporation)
